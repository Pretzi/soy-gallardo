# Offline Architecture Comparison

Visual guide showing current vs. offline-enabled architecture for Soy Gallardo app.

---

## ğŸ“Š Current Architecture (Online Only)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER DEVICE                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Next.js App (Browser)                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â€¢ React Components (UI)                              â”‚  â”‚
â”‚  â”‚  â€¢ Form validation (client-side)                      â”‚  â”‚
â”‚  â”‚  â€¢ No local storage                                   â”‚  â”‚
â”‚  â”‚  â€¢ No offline capability                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                       â”‚
â”‚                      â”‚ REQUIRES INTERNET                     â”‚
â”‚                      â”‚ âŒ Fails if no connection             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP/HTTPS
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NEXT.JS SERVER (Vercel/AWS)                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           API Routes (/api/...)                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â€¢ /api/entries â†’ DynamoDB CRUD                       â”‚  â”‚
â”‚  â”‚  â€¢ /api/search â†’ DynamoDB Query                       â”‚  â”‚
â”‚  â”‚  â€¢ /api/ine/parse â†’ OpenAI API                        â”‚  â”‚
â”‚  â”‚  â€¢ /api/selfie/upload â†’ S3 + Processing              â”‚  â”‚
â”‚  â”‚  â€¢ /api/ine/upload â†’ S3                               â”‚  â”‚
â”‚  â”‚  â€¢ /api/options/* â†’ CSV files                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ AWS SDK
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AWS SERVICES                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  DynamoDB    â”‚    â”‚      S3      â”‚    â”‚  OpenAI API  â”‚ â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚  (External)  â”‚ â”‚
â”‚  â”‚  â€¢ Entries   â”‚    â”‚  â€¢ Selfies   â”‚    â”‚              â”‚ â”‚
â”‚  â”‚  â€¢ GSI1      â”‚    â”‚  â€¢ INE imgs  â”‚    â”‚  â€¢ GPT-4o    â”‚ â”‚
â”‚  â”‚  â€¢ GSI2      â”‚    â”‚              â”‚    â”‚  â€¢ Vision    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ PROBLEM: Without internet, NOTHING works
   - Can't view entries
   - Can't create entries
   - Can't search
   - App is completely unusable
```

---

## âœ… Proposed Offline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER DEVICE                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Next.js App (Browser)                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚      React Components + Hooks                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ useOffline() hook                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Online/Offline detection                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Sync status indicators                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                      â–²                                 â”‚  â”‚
â”‚  â”‚                      â”‚                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         Service Worker (PWA)                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Cache static assets                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Background sync                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Offline page serving                         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                      â–²                                 â”‚  â”‚
â”‚  â”‚                      â”‚                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         IndexedDB (Local Database)              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Stores:                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ 'entries'                       â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - id (key)                     â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - folio, nombre, apellidos...  â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - syncStatus: 'synced'|'pending'â”‚           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - Indexes: by-folio, by-name   â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ 'queue'                         â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - id (key)                     â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - type: CREATE|UPDATE|DELETE   â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - data: Entry                  â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - status: pending|syncing|failedâ”‚           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - photos: Blob[]               â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ 'metadata'                      â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - lastSyncTime                 â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - localidades (cached)         â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  - secciones (cached)           â”‚            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Capacity: ~1 GB on mobile, ~60% disk desktop   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                      â–²                                 â”‚  â”‚
â”‚  â”‚                      â”‚                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         Sync Queue Manager                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Detects online/offline                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Processes queue when online                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Retry logic with backoff                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Conflict resolution                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Progress reporting                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                   â”‚
â”‚                         â”‚ âœ… Works offline                  â”‚
â”‚                         â”‚ ğŸ”„ Syncs when online              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP/HTTPS
                          â”‚ (only when online)
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NEXT.JS SERVER (Vercel/AWS)                     â”‚
â”‚              (Same as before - no changes needed)            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           API Routes (/api/...)                       â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â€¢ /api/entries â†’ DynamoDB CRUD                       â”‚  â”‚
â”‚  â”‚  â€¢ /api/search â†’ DynamoDB Query                       â”‚  â”‚
â”‚  â”‚  â€¢ /api/ine/parse â†’ OpenAI API                        â”‚  â”‚
â”‚  â”‚  â€¢ /api/selfie/upload â†’ S3 + Processing              â”‚  â”‚
â”‚  â”‚  â€¢ /api/ine/upload â†’ S3                               â”‚  â”‚
â”‚  â”‚  â€¢ /api/options/* â†’ CSV files                         â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  NEW: /api/sync/batch â†’ Batch upload from queue      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ AWS SDK
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AWS SERVICES                             â”‚
â”‚                     (Same as before)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  DynamoDB    â”‚    â”‚      S3      â”‚    â”‚  OpenAI API  â”‚ â”‚
â”‚  â”‚              â”‚    â”‚              â”‚    â”‚  (External)  â”‚ â”‚
â”‚  â”‚  â€¢ Entries   â”‚    â”‚  â€¢ Selfies   â”‚    â”‚              â”‚ â”‚
â”‚  â”‚  â€¢ GSI1      â”‚    â”‚  â€¢ INE imgs  â”‚    â”‚  â€¢ GPT-4o    â”‚ â”‚
â”‚  â”‚  â€¢ GSI2      â”‚    â”‚              â”‚    â”‚  â€¢ Vision    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… SOLUTION: App works offline!
   - Can view synced entries
   - Can create new entries
   - Can search locally
   - Syncs automatically when online
```

---

## ğŸ”„ User Flow Comparison

### Current Flow (Online Only)

```
User Opens App
      â”‚
      â–¼
  ğŸ“¡ Check Auth (requires server)
      â”‚
      â”œâ”€ âŒ No Internet â†’ ERROR PAGE
      â”‚
      â–¼
  ğŸ“¡ Fetch Entries (DynamoDB)
      â”‚
      â”œâ”€ âŒ No Internet â†’ ERROR PAGE
      â”‚
      â–¼
  Display List
      â”‚
      â–¼
User Creates Entry
      â”‚
      â–¼
  ğŸ“¡ Upload Photos (S3)
      â”‚
      â”œâ”€ âŒ No Internet â†’ ERROR, DATA LOST
      â”‚
      â–¼
  ğŸ“¡ Save Entry (DynamoDB)
      â”‚
      â”œâ”€ âŒ No Internet â†’ ERROR, DATA LOST
      â”‚
      â–¼
  Success âœ…
```

### Proposed Flow (Offline-Enabled)

```
User Opens App
      â”‚
      â–¼
  âœ… Check Auth (cached token)
      â”‚
      â”œâ”€ âŒ No Internet â†’ Use cached auth âœ…
      â”‚
      â–¼
  ğŸ” Check Network Status
      â”‚
      â”œâ”€ ğŸŸ¢ Online
      â”‚   â”‚
      â”‚   â”œâ”€ ğŸ“¡ Fetch Latest Entries (DynamoDB)
      â”‚   â”‚
      â”‚   â”œâ”€ ğŸ’¾ Save to IndexedDB
      â”‚   â”‚
      â”‚   â””â”€ ğŸ”„ Process Sync Queue
      â”‚
      â”œâ”€ ğŸŸ¡ Offline
      â”‚   â”‚
      â”‚   â””â”€ ğŸ’¾ Load from IndexedDB âœ…
      â”‚
      â–¼
  Display List âœ…
      â”‚
      â–¼
User Creates Entry
      â”‚
      â–¼
  ğŸ” Check Network Status
      â”‚
      â”œâ”€ ğŸŸ¢ Online
      â”‚   â”‚
      â”‚   â”œâ”€ ğŸ“¡ Upload Photos (S3)
      â”‚   â”œâ”€ ğŸ“¡ Save Entry (DynamoDB)
      â”‚   â””â”€ ğŸ’¾ Update IndexedDB
      â”‚
      â”œâ”€ ğŸŸ¡ Offline
      â”‚   â”‚
      â”‚   â”œâ”€ ğŸ’¾ Save to IndexedDB âœ…
      â”‚   â”œâ”€ ğŸ’¾ Store Photos as Blobs âœ…
      â”‚   â”œâ”€ â• Add to Sync Queue âœ…
      â”‚   â””â”€ ğŸŸ¡ Show "Pending Sync" badge
      â”‚
      â–¼
  Success âœ…
      â”‚
      â”‚ (later, when online)
      â”‚
      â–¼
  ğŸ”„ Auto Background Sync
      â”‚
      â”œâ”€ ğŸ“¡ Upload Photos (S3)
      â”œâ”€ ğŸ“¡ Save Entry (DynamoDB)
      â”œâ”€ âœ… Mark as Synced
      â””â”€ ğŸŸ¢ Update badge to "Synced"
```

---

## ğŸ“± Mobile App Installation (PWA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: User visits app in browser                     â”‚
â”‚                                                          â”‚
â”‚  https://soy-gallardo.com                               â”‚
â”‚         â”‚                                                â”‚
â”‚         â–¼                                                â”‚
â”‚  Browser detects PWA manifest                           â”‚
â”‚         â”‚                                                â”‚
â”‚         â–¼                                                â”‚
â”‚  Shows "Add to Home Screen" prompt                      â”‚
â”‚         â”‚                                                â”‚
â”‚         â–¼                                                â”‚
â”‚  User clicks "Add"                                      â”‚
â”‚         â”‚                                                â”‚
â”‚         â–¼                                                â”‚
â”‚  App installs on device                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ğŸ“± Device Home Screen                â”‚              â”‚
â”‚  â”‚                                        â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”           â”‚              â”‚
â”‚  â”‚  â”‚ ğŸ“§  â”‚  â”‚ ğŸŒ  â”‚  â”‚ ğŸ—³ï¸   â”‚           â”‚              â”‚
â”‚  â”‚  â”‚Mail â”‚  â”‚Safariâ”‚  â”‚Soy  â”‚ â† NEW!   â”‚              â”‚
â”‚  â”‚  â”‚     â”‚  â”‚     â”‚  â”‚Gall.â”‚           â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜           â”‚              â”‚
â”‚  â”‚                                        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                          â”‚
â”‚  Step 2: User opens app from home screen                â”‚
â”‚         â”‚                                                â”‚
â”‚         â–¼                                                â”‚
â”‚  App opens in fullscreen (no browser UI)                â”‚
â”‚         â”‚                                                â”‚
â”‚         â–¼                                                â”‚
â”‚  Works like native app                                  â”‚
â”‚  â€¢ Offline support                                      â”‚
â”‚  â€¢ Push notifications (optional)                        â”‚
â”‚  â€¢ Background sync                                      â”‚
â”‚  â€¢ Fast loading                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Data Flow: Create Entry Offline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. USER FILLS FORM (Offline)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Folio: 000123                                             â”‚
â”‚  Nombre: JUAN                                              â”‚
â”‚  Apellidos: GARCIA LOPEZ                                   â”‚
â”‚  ...                                                        â”‚
â”‚                                                            â”‚
â”‚  [ğŸ“· Take Selfie] â†’ Captures photo                        â”‚
â”‚  [ğŸ“· Upload INE] â†’ Captures INE                           â”‚
â”‚                                                            â”‚
â”‚  [ğŸ’¾ Save] button clicked                                  â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. CLIENT-SIDE VALIDATION                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  âœ… Validate with Zod schema                               â”‚
â”‚  âœ… Check required fields                                  â”‚
â”‚  âœ… Format phone number                                    â”‚
â”‚  âœ… Normalize names                                        â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. DETECT OFFLINE STATUS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  if (navigator.onLine === false) {                         â”‚
â”‚    // OFFLINE PATH                                         â”‚
â”‚  }                                                          â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. SAVE TO INDEXEDDB                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  const entry = {                                           â”‚
â”‚    id: 'temp-' + Date.now(),  // Temporary ID             â”‚
â”‚    folio: '000123',                                        â”‚
â”‚    nombre: 'JUAN',                                         â”‚
â”‚    apellidos: 'GARCIA LOPEZ',                             â”‚
â”‚    ...                                                      â”‚
â”‚    syncStatus: 'pending',  // Mark as pending             â”‚
â”‚    createdAt: new Date().toISOString()                    â”‚
â”‚  };                                                         â”‚
â”‚                                                            â”‚
â”‚  await db.put('entries', entry);  // Store in IndexedDB   â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. STORE PHOTOS AS BLOBS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  const selfieBlob = await fetch(selfieDataUrl)            â”‚
â”‚                         .then(r => r.blob());             â”‚
â”‚                                                            â”‚
â”‚  const ineFrontBlob = await fetch(ineFrontDataUrl)        â”‚
â”‚                           .then(r => r.blob());           â”‚
â”‚                                                            â”‚
â”‚  // Store with entry reference                            â”‚
â”‚  await db.put('photos', {                                 â”‚
â”‚    entryId: entry.id,                                     â”‚
â”‚    selfie: selfieBlob,                                    â”‚
â”‚    ineFront: ineFrontBlob                                 â”‚
â”‚  });                                                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ADD TO SYNC QUEUE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  const queueItem = {                                       â”‚
â”‚    id: generateId(),                                       â”‚
â”‚    type: 'CREATE',                                         â”‚
â”‚    timestamp: Date.now(),                                 â”‚
â”‚    data: entry,                                            â”‚
â”‚    status: 'pending',                                      â”‚
â”‚    retryCount: 0                                          â”‚
â”‚  };                                                         â”‚
â”‚                                                            â”‚
â”‚  await db.add('queue', queueItem);                        â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. UPDATE UI                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  âœ… Show success message:                                  â”‚
â”‚     "Entrada guardada. Se sincronizarÃ¡ cuando            â”‚
â”‚      haya conexiÃ³n a internet."                           â”‚
â”‚                                                            â”‚
â”‚  ğŸŸ¡ Show pending badge on entry                           â”‚
â”‚                                                            â”‚
â”‚  â• Update pending count: (3 pendientes)                  â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚
                 â”‚  â° Later... User gets internet
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. AUTO BACKGROUND SYNC                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  // Browser detects connection                            â”‚
â”‚  window.addEventListener('online', async () => {          â”‚
â”‚    await processQueue();                                  â”‚
â”‚  });                                                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. PROCESS QUEUE                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  for each pending item in queue:                          â”‚
â”‚                                                            â”‚
â”‚    1. Upload selfie to S3                                 â”‚
â”‚       POST /api/selfie/upload                             â”‚
â”‚       â†’ Returns: { url, s3Key }                           â”‚
â”‚                                                            â”‚
â”‚    2. Upload INE to S3                                    â”‚
â”‚       POST /api/ine/upload                                â”‚
â”‚       â†’ Returns: { url, s3Key }                           â”‚
â”‚                                                            â”‚
â”‚    3. Create entry in DynamoDB                            â”‚
â”‚       POST /api/entries                                   â”‚
â”‚       Body: { ...entry, selfieUrl, ineFrontUrl }          â”‚
â”‚       â†’ Returns: { id, ... } (real ID from server)        â”‚
â”‚                                                            â”‚
â”‚    4. Update local entry with server ID                   â”‚
â”‚       await db.put('entries', {                           â”‚
â”‚         ...entry,                                          â”‚
â”‚         id: serverEntry.id,  // Replace temp ID          â”‚
â”‚         syncStatus: 'synced'                              â”‚
â”‚       });                                                  â”‚
â”‚                                                            â”‚
â”‚    5. Remove from queue                                   â”‚
â”‚       await db.delete('queue', queueItem.id);            â”‚
â”‚                                                            â”‚
â”‚    6. Delete local photo blobs                            â”‚
â”‚       await db.delete('photos', entry.id);               â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  10. UPDATE UI                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  âœ… Change badge from ğŸŸ¡ Pending â†’ ğŸŸ¢ Synced              â”‚
â”‚                                                            â”‚
â”‚  âœ… Show notification:                                     â”‚
â”‚     "3 entradas sincronizadas correctamente"             â”‚
â”‚                                                            â”‚
â”‚  âœ… Update pending count: (0 pendientes)                  â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ UI Changes

### Before (No Offline Support)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Registro de Afiliados                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                             â”‚
â”‚  ğŸ” [Buscar por folio o nombre...]  [ğŸ”]   â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 000123  JUAN GARCIA LOPEZ             â”‚ â”‚
â”‚  â”‚ 555-1234  Ciudad de MÃ©xico            â”‚ â”‚
â”‚  â”‚ [Ver detalles â†’]                      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ 000124  MARIA RODRIGUEZ SANCHEZ       â”‚ â”‚
â”‚  â”‚ 555-5678  Guadalajara                 â”‚ â”‚
â”‚  â”‚ [Ver detalles â†’]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚  [+ Nueva Entrada]                          â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After (With Offline Support)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Registro de Afiliados                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸŸ¡ MODO OFFLINE - Trabajando con datos locales â”‚   â”‚
â”‚  â”‚ Ãšltima sincronizaciÃ³n: hace 2 horas            â”‚   â”‚
â”‚  â”‚ [ğŸ”„ Sincronizar Ahora]                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  ğŸ” [Buscar por folio o nombre...]  [ğŸ”]               â”‚
â”‚                                                         â”‚
â”‚  â³ 3 entradas pendientes de sincronizaciÃ³n            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸŸ¡ 000123  JUAN GARCIA LOPEZ    [Pendiente]    â”‚  â”‚
â”‚  â”‚    555-1234  Ciudad de MÃ©xico                   â”‚  â”‚
â”‚  â”‚    Creada: hace 5 min (sin conexiÃ³n)           â”‚  â”‚
â”‚  â”‚    [Ver detalles â†’]                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŸ¢ 000124  MARIA RODRIGUEZ SANCHEZ [Sincronizada]â”‚ â”‚
â”‚  â”‚    555-5678  Guadalajara                        â”‚  â”‚
â”‚  â”‚    [Ver detalles â†’]                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŸ¡ 000125  PEDRO MARTINEZ LOPEZ  [Pendiente]   â”‚  â”‚
â”‚  â”‚    555-9999  Monterrey                          â”‚  â”‚
â”‚  â”‚    Creada: hace 2 min (sin conexiÃ³n)           â”‚  â”‚
â”‚  â”‚    [Ver detalles â†’]                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  [+ Nueva Entrada] âœ… Funciona sin internet            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Sync Timeline

```
Time: 09:00 AM - User starts work (NO INTERNET)
      â”‚
      â”œâ”€ ğŸ“± Opens app from home screen
      â”œâ”€ ğŸ’¾ Loads 145 entries from IndexedDB
      â””â”€ ğŸŸ¡ Shows "OFFLINE MODE" banner
      
Time: 09:15 AM - Creates Entry #1 (OFFLINE)
      â”‚
      â”œâ”€ ğŸ“ Fills form: JUAN GARCIA
      â”œâ”€ ğŸ“· Takes selfie
      â”œâ”€ ğŸ“· Takes INE photo
      â”œâ”€ ğŸ’¾ Saves to IndexedDB
      â””â”€ â• Adds to sync queue (1 pending)
      
Time: 09:30 AM - Creates Entry #2 (OFFLINE)
      â”‚
      â”œâ”€ ğŸ“ Fills form: MARIA RODRIGUEZ
      â”œâ”€ ğŸ“· Takes selfie
      â”œâ”€ ğŸ“· Takes INE photo
      â”œâ”€ ğŸ’¾ Saves to IndexedDB
      â””â”€ â• Adds to sync queue (2 pending)
      
Time: 09:45 AM - Edits Entry (OFFLINE)
      â”‚
      â”œâ”€ âœï¸ Opens Entry #000120
      â”œâ”€ âœï¸ Changes phone number
      â”œâ”€ ğŸ’¾ Updates in IndexedDB
      â””â”€ â• Adds UPDATE to sync queue (3 pending)
      
Time: 10:00 AM - Searches entries (OFFLINE)
      â”‚
      â”œâ”€ ğŸ” Searches "GARCIA"
      â”œâ”€ ğŸ’¾ Queries IndexedDB
      â””â”€ âœ… Shows 5 results (instant, from local DB)
      
Time: 11:30 AM - Internet connection returns!
      â”‚
      â”œâ”€ ğŸŸ¢ Browser detects online
      â”œâ”€ ğŸ”” Shows notification: "Connection restored"
      â”œâ”€ ğŸ”„ Background sync starts automatically
      â”‚
      â”œâ”€ [Processing Queue Item 1/3]
      â”‚   â”œâ”€ ğŸ“¤ Upload selfie â†’ S3
      â”‚   â”œâ”€ ğŸ“¤ Upload INE â†’ S3
      â”‚   â”œâ”€ ğŸ“¤ POST /api/entries â†’ DynamoDB
      â”‚   â””â”€ âœ… Entry #1 synced (1/3 complete)
      â”‚
      â”œâ”€ [Processing Queue Item 2/3]
      â”‚   â”œâ”€ ğŸ“¤ Upload selfie â†’ S3
      â”‚   â”œâ”€ ğŸ“¤ Upload INE â†’ S3
      â”‚   â”œâ”€ ğŸ“¤ POST /api/entries â†’ DynamoDB
      â”‚   â””â”€ âœ… Entry #2 synced (2/3 complete)
      â”‚
      â”œâ”€ [Processing Queue Item 3/3]
      â”‚   â”œâ”€ ğŸ“¤ PUT /api/entries/000120 â†’ DynamoDB
      â”‚   â””â”€ âœ… Edit synced (3/3 complete)
      â”‚
      â”œâ”€ ğŸ’¾ Updates local entries with server IDs
      â”œâ”€ ğŸ§¹ Clears sync queue
      â”œâ”€ ğŸ§¹ Deletes local photo blobs
      â””â”€ ğŸ”” Shows notification: "3 cambios sincronizados"
      
Time: 11:35 AM - All caught up!
      â”‚
      â”œâ”€ ğŸŸ¢ Shows "ONLINE MODE" banner
      â”œâ”€ ğŸ“¥ Fetches latest entries from server
      â”œâ”€ ğŸ’¾ Updates IndexedDB with new entries
      â””â”€ âœ… User can continue working (online or offline)
```

---

## ğŸ”§ Technical Implementation Summary

### New Dependencies

```json
{
  "dependencies": {
    "idb": "^8.0.0",           // IndexedDB wrapper
    "next-pwa": "^5.6.0"       // PWA support
  }
}
```

### New Files

```
lib/
  indexeddb.ts              # IndexedDB helpers (~300 lines)
  sync-queue.ts             # Sync queue manager (~200 lines)
  offline-utils.ts          # Utility functions (~100 lines)

contexts/
  OfflineContext.tsx        # React context (~150 lines)

hooks/
  useOffline.ts             # Custom hook (~50 lines)
  useSync.ts                # Sync hook (~100 lines)

public/
  manifest.json             # PWA manifest (~30 lines)
  service-worker.js         # Auto-generated by next-pwa
```

### Modified Files

```
app/
  layout.tsx               # Add OfflineProvider wrapper
  entries/
    page.tsx               # Use IndexedDB + sync
    new/page.tsx           # Queue saves
    [id]/
      page.tsx             # Load from IndexedDB
      edit/page.tsx        # Queue updates

components/
  HeaderNav.tsx            # Add offline indicator
  forms/EntryForm.tsx      # Handle offline saves

next.config.ts             # Add PWA config
```

### Lines of Code (Estimate)

- **New code:** ~1,500 lines
- **Modified code:** ~500 lines
- **Total:** ~2,000 lines

---

## ğŸ“ˆ Performance Comparison

### Before (Online Only)

| Action | Time | Network |
|--------|------|---------|
| Load entries list | 500-2000ms | Required |
| Search entries | 300-1000ms | Required |
| View entry | 200-800ms | Required |
| Create entry | 2000-5000ms | Required |
| Upload photo | 3000-8000ms | Required |

**Total time to create 10 entries:** ~50-80 seconds

### After (Offline-Enabled)

| Action | Time | Network |
|--------|------|---------|
| Load entries list | 50-200ms | Optional |
| Search entries | 10-50ms | Not required |
| View entry | 5-20ms | Not required |
| Create entry | 100-500ms | Not required |
| Upload photo | 50-200ms | Not required (queued) |

**Total time to create 10 entries:** ~5-10 seconds (offline)
**Sync time (when online):** ~30-60 seconds (background)

**âš¡ 80-90% faster for user** (no waiting for uploads!)

---

## ğŸ’¡ Key Benefits

### For Users
âœ… Work in remote areas with no signal  
âœ… No data loss if connection drops  
âœ… Faster app (instant local operations)  
âœ… Can review data anytime  
âœ… Install as mobile app  
âœ… No "Error" messages disrupting workflow  

### For Organization
âœ… More productive field workers  
âœ… Data captured even in dead zones  
âœ… Less AWS API calls (sync in batches)  
âœ… Better user satisfaction  
âœ… Competitive advantage  

### For Developers
âœ… Modern web standards (PWA)  
âœ… Easier testing (mock offline mode)  
âœ… Better error handling  
âœ… Future-proof architecture  

---

## ğŸš§ Migration Path

### Phase 1: No Breaking Changes
- Add offline features alongside existing functionality
- Users can choose online or offline mode
- Gradual rollout

### Phase 2: Testing
- Test with pilot users
- Gather feedback
- Fix issues

### Phase 3: Full Deployment
- Enable for all users
- Provide training
- Monitor performance

### Phase 4: Optimization
- Remove online-only code paths
- Optimize IndexedDB queries
- Reduce bundle size

**No downtime required!** âœ…

---

Ready to implement? Choose your path:
1. **Quick Wins** - 1-2 days, better UX
2. **Minimum Viable** - 2 weeks, basic offline
3. **Full Featured** - 4 weeks, complete offline support

Let me know and I'll start coding! ğŸš€
